<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UniMovie - Movie Recommendations</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .btn-clicked {
            background-color: #007bff !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">UniMovie</a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="recommendation.html">Movie Recommendations</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="faceswap.html">Face Swap with Movie Poster</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="predict.html">Movie Success Predict</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h2>Movie Recommendations</h2>
        <div class="card">
            <div class="card-body">
                <form id="recommendForm">
                    <div class="mb-3">
                        <label for="season" class="form-label">Season</label>
                        <select class="form-select" id="season" required>
                            <option value="">Choose...</option>
                            <option value="summer">Summer</option>
                            <option value="winter">Winter</option>
                            <option value="fall">Fall</option>
                            <option value="spring">Spring</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="genre" class="form-label">Genre (option)</label>
                        <select class="form-select" id="genre">
                            <option value="">Choose a genre...</option>
                            <option value="Children's">Children's</option>
                            <option value="Adventure">Adventure</option>
                            <option value="Romance">Romance</option>
                            <option value="Musical">Musical</option>
                            <option value="Comedy">Comedy</option>
                            <option value="Thriller">Thriller</option>
                            <option value="Horror">Horror</option>
                            <option value="Crime">Crime</option>
                            <option value="Mystery">Mystery</option>
                            <option value="Western">Western</option>
                            <option value="Sci-Fi">Sci-Fi</option>
                            <option value="Animation">Animation</option>
                            <option value="War">War</option>
                            <option value="Drama">Drama</option>
                            <option value="Fantasy">Fantasy</option>
                            <option value="Action">Action</option>
                            <option value="Documentary">Documentary</option>
                            <option value="Film-Noir">Film-Noir</option>
                        </select>
                    </div>
                    <button type="button" id="getTop10" class="btn btn-outline-secondary">Get Top 10 Recommendations</button>
                    <button type="submit" id="getRandom" class="btn btn-outline-primary" disabled>Get Random Recommendations</button>
                </form>
                <p id="instruction" class="mt-2 text-muted">* Click "Get Top 10 Recommendations" first.</p>
            </div>
        </div>

        <div class="mt-4" id="results">
            <h3>Recommendations</h3>
            <div id="movieList" class="row"></div>
        </div>
    </div>

    <script src="main.js"></script>
    <script>
        $(document).ready(function () {
            let currentSeason = ""; 
            let currentGenre = ""; 

            $("#recommendForm").submit(function (event) {
                event.preventDefault();
                const season = $("#season").val();
                const genre = $("#genre").val();
                if (!season) {
                    alert("Please select a season.");
                    return;
                }
                fetchMovies('/movies/recommend', season, genre);
            });

            $("#getTop10").click(function () {
                const season = $("#season").val();
                const genre = $("#genre").val();
                if (!season) {
                    alert("Please select a season.");
                    return;
                }
                fetchMovies('/movies/recommend/top10', season, genre);
                $("#getRandom").prop("disabled", false); 
                $("#instruction").hide(); 
                currentSeason = season;
                currentGenre = genre; 
            });

            $("#season, #genre").change(function () {
                $("#getRandom").prop("disabled", true); 
                $("#instruction").show(); 
            });

            function fetchMovies(endpoint, season, genre) {
                let url = `http://localhost:8080${endpoint}?season=${season}`;
                if (genre) {
                    url += `&genre=${genre}`;
                }

                $.ajax({
                    dataType: "json",
                    url: url,
                    method: "GET",
                    success: function (data) {
                        displayMovies(data);
                    },
                    error: function (error) {
                        console.error("Error fetching movies:", error);
                    }
                });
            }

            function displayMovies(movies) {
                const movieList = $("#movieList");
                movieList.empty();
                if (movies.length === 0) {
                    movieList.append('<p>No movies found for the selected criteria.</p>');
                } else {
                    movies.forEach(movie => {
                        const movieCard = `
                            <div class="col-md-3">
                                <div class="card mb-3">
                                    <div class="card-body">
                                        <h5 class="card-title">${movie.title}</h5>
                                        <p class="card-text">Season: ${movie.season}</p>
                                        <p class="card-text">Genre: ${movie.genre}</p>
                                        <p class="card-text">Rating: ${movie.rating}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                        movieList.append(movieCard);
                    });
                }
            }
        });
    </script>
</body>
</html>